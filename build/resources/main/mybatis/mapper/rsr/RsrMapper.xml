<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="io.vpplab.flow.domain.rsr.RsrDao">
    <select id="getClcRsrList" parameterType="hashMap" resultType="hashMap">
        SELECT
            AA.잡합자원ID
             ,AA.집합자원그룹명
             ,AA.집합자원구분
             ,AA.운영상태
             ,AA.신청유형
             ,AA.처리상태
             ,AA.구성수
             ,AA.자원용량
             ,AA.PVWT용량
             ,AA.ESS용량
             ,AA.평균오차율
             ,AA.오차율평가
             ,AA.거래가능기간
             ,AA.신청일자
             ,AA.로그인ID
        FROM(SELECT
                 C.id AS 잡합자원ID
                  ,C.name AS 집합자원그룹명
                  ,C.type AS 집합자원구분
                  , '' AS 운영상태
                  ,C.apply_type AS 신청유형
                  ,C.apply_status AS 처리상태
                  ,SUM(E.plant_cnt) AS 구성수
                  ,'' AS 자원용량
                  ,SUM(E.capacity01) AS PVWT용량
                  ,SUM(E.capacity04) AS ESS용량
                  ,'' AS 평균오차율
                  ,'' AS 오차율평가
                  ,'' AS 거래가능기간
                  ,C.created_at AS 신청일자
                  ,A.login_id AS 로그인ID
             FROM user A
                      INNER JOIN user_resource_mapping B ON A.id = B.user_id
                      INNER JOIN resource C ON B.reource_id =  C.id
                      LEFT OUTER JOIN resource_set D ON C.id = D.resource_id
                      LEFT OUTER JOIN (SELECT
                                           id
                                            ,COUNT(id) AS  plant_cnt
                                            ,CASE WHEN type ='01' OR type = '02' THEN SUM(capacity) END AS capacity01
                                            ,CASE WHEN type ='04' THEN SUM(capacity) END AS capacity04
                                       FROM plant GROUP BY id) E ON D.plant_id = E.id) AA
        WHERE 1=1
    AND AA.로그인ID = #{로그인ID}
    LIMIT #{페이지번호},#{행갯수}
    </select>
    <select id="getClcRsrListCnt" parameterType="hashMap" resultType="int">
        SELECT
            AA.잡합자원ID
             ,AA.집합자원그룹명
             ,AA.집합자원구분
             ,AA.운영상태
             ,AA.신청유형
             ,AA.처리상태
             ,AA.구성수
             ,AA.자원용량
             ,AA.PVWT용량
             ,AA.ESS용량
             ,AA.평균오차율
             ,AA.오차율평가
             ,AA.거래가능기간
             ,AA.신청일자
             ,AA.로그인ID
        FROM(SELECT
                 C.id AS 잡합자원ID
                  ,C.name AS 집합자원그룹명
                  ,C.type AS 집합자원구분
                  , '' AS 운영상태
                  ,C.apply_type AS 신청유형
                  ,C.apply_status AS 처리상태
                  ,SUM(E.plant_cnt) AS 구성수
                  ,'' AS 자원용량
                  ,SUM(E.capacity01) AS PVWT용량
                  ,SUM(E.capacity04) AS ESS용량
                  ,'' AS 평균오차율
                  ,'' AS 오차율평가
                  ,'' AS 거래가능기간
                  ,C.created_at AS 신청일자
                  ,A.login_id AS 로그인ID
             FROM user A
                      INNER JOIN user_resource_mapping B ON A.id = B.user_id
                      INNER JOIN resource C ON B.reource_id =  C.id
                      LEFT OUTER JOIN resource_set D ON C.id = D.resource_id
                      LEFT OUTER JOIN (SELECT
                                           id
                                            ,COUNT(id) AS  plant_cnt
                                            ,CASE WHEN type ='01' OR type = '02' THEN SUM(capacity) END AS capacity01
                                            ,CASE WHEN type ='04' THEN SUM(capacity) END AS capacity04
                                       FROM plant GROUP BY id) E ON D.plant_id = E.id) AA
        WHERE 1=1
          AND AA.로그인ID = #{로그인ID}
    </select>

</mapper>